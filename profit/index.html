<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employcase Interactive Profit Margin Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827;
            color: #d1d5db;
        }
        .card {
            background-color: #1f2937;
            border: 1px solid #374151;
        }
        .input-label {
            color: #9ca3af;
        }
        .input-field {
            background-color: #374151;
            border: 1px solid #4b5563;
            color: #d1d5db;
        }
        .positive-margin {
            color: #22c55e;
        }
        .negative-margin {
            color: #ef4444;
        }
        .table-header {
            background-color: #374151;
        }
    </style>
</head>
<body class="antialiased">
    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-white">Employcase Profit Margin Calculator</h1>
            <p class="mt-2 text-lg text-gray-400">Adjust pricing, sessions, and costs to see real-time profit analysis.</p>
        </header>

        <main>
            <!-- Global Costs Configuration -->
            <div class="card p-6 rounded-lg shadow-lg mb-8">
                 <h2 class="text-2xl font-semibold text-white mb-4">Global Costs</h2>
                 <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                     <div>
                        <label for="cost_per_session" class="block text-sm font-medium input-label">Cost per Session ($)</label>
                        <input type="number" id="cost_per_session" step="0.0001" class="input-field mt-1 block w-full rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-2" value="0.0045">
                    </div>
                    <div>
                        <label for="server_cost" class="block text-sm font-medium input-label">Monthly Server Cost ($)</label>
                        <input type="number" id="server_cost" class="input-field mt-1 block w-full rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-2" value="0">
                    </div>
                 </div>
            </div>

            <!-- Tiers Configuration -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                <!-- Tier 1 Card -->
                <div class="card p-6 rounded-lg shadow-lg">
                    <h2 class="text-2xl font-semibold text-white mb-4">Tier 1</h2>
                    <div class="space-y-4">
                        <div>
                            <label for="t1_price" class="block text-sm font-medium input-label">Price per Month ($)</label>
                            <input type="number" id="t1_price" class="input-field mt-1 block w-full rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-2" value="30">
                        </div>
                        <div>
                            <label for="t1_sessions" class="block text-sm font-medium input-label">Max Sessions</label>
                            <input type="number" id="t1_sessions" class="input-field mt-1 block w-full rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-2" value="1000">
                        </div>
                    </div>
                </div>
                <!-- Tier 2 Card -->
                <div class="card p-6 rounded-lg shadow-lg">
                    <h2 class="text-2xl font-semibold text-white mb-4">Tier 2</h2>
                    <div class="space-y-4">
                        <div>
                            <label for="t2_price" class="block text-sm font-medium input-label">Price per Month ($)</label>
                            <input type="number" id="t2_price" class="input-field mt-1 block w-full rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-2" value="100">
                        </div>
                        <div>
                            <label for="t2_sessions" class="block text-sm font-medium input-label">Max Sessions</label>
                            <input type="number" id="t2_sessions" class="input-field mt-1 block w-full rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-2" value="5000">
                        </div>
                    </div>
                </div>
                <!-- Tier 3 Card -->
                <div class="card p-6 rounded-lg shadow-lg">
                    <h2 class="text-2xl font-semibold text-white mb-4">Tier 3</h2>
                    <div class="space-y-4">
                        <div>
                            <label for="t3_price" class="block text-sm font-medium input-label">Price per Month ($)</label>
                            <input type="number" id="t3_price" class="input-field mt-1 block w-full rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-2" value="500">
                        </div>
                        <div>
                            <label for="t3_sessions" class="block text-sm font-medium input-label">Max Sessions</label>
                            <input type="number" id="t3_sessions" class="input-field mt-1 block w-full rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-2" value="30000">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Results Table -->
            <div class="card rounded-lg shadow-lg overflow-hidden">
                 <div class="p-4 sm:p-6">
                    <h3 class="text-xl font-semibold text-white">Profit & Margin Analysis (per user)</h3>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-700">
                        <thead class="table-header">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Tier</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Worst-Case (Profit/Margin)</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Best-Case (Profit/Margin)</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Average (Profit/Margin)</th>
                            </tr>
                        </thead>
                        <tbody id="results-table" class="bg-gray-800 divide-y divide-gray-700">
                            <!-- Rows will be injected by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Overall Average -->
            <div class="card mt-8 p-6 rounded-lg shadow-lg text-center">
                 <h3 class="text-xl font-semibold text-white">Estimated Average Profit Margin Across Tiers</h3>
                 <p id="overall-average" class="text-3xl font-bold mt-2 positive-margin">0.00%</p>
            </div>
        </main>
    </div>

    <script>
        // --- CONSTANTS AND INITIAL DATA ---
        const tiers = {
            'Tier 1': { id_prefix: 't1', min_sessions: 51 },
            'Tier 2': { id_prefix: 't2', min_sessions: 1001 },
            'Tier 3': { id_prefix: 't3', min_sessions: 5001 }
        };

        // --- DOM ELEMENTS ---
        const inputs = document.querySelectorAll('input[type="number"]');
        const resultsTable = document.getElementById('results-table');
        const overallAverageEl = document.getElementById('overall-average');
        const costPerSessionEl = document.getElementById('cost_per_session');
        const serverCostEl = document.getElementById('server_cost');


        // --- CORE CALCULATION LOGIC ---
        function calculateMargins() {
            let totalAverageMargin = 0;
            let tierCount = 0;
            
            resultsTable.innerHTML = ''; // Clear previous results

            const costPerSession = parseFloat(costPerSessionEl.value) || 0;
            const serverCost = parseFloat(serverCostEl.value) || 0;

            for (const tierName in tiers) {
                const tierData = tiers[tierName];
                const tierId = tierData.id_prefix;
                
                const priceEl = document.getElementById(`${tierId}_price`);
                const sessionsEl = document.getElementById(`${tierId}_sessions`);

                if (!priceEl || !sessionsEl) {
                    console.error(`Could not find elements for ${tierName}`);
                    continue;
                }

                const price = parseFloat(priceEl.value) || 0;
                const max_sessions = parseInt(sessionsEl.value) || 0;
                const min_sessions = tierData.min_sessions;

                // --- Calculations for each scenario ---
                // Note: Server cost is now subtracted from profit for each user.
                // This shows the profit *per user* assuming the server cost is distributed.
                // For a more accurate total profit, you would multiply per-user profit by user count and then subtract the single server cost.

                // Worst Case
                const worstCaseCost = max_sessions * costPerSession;
                const worstCaseProfit = price - worstCaseCost - serverCost;
                const worstCaseMargin = price > 0 ? (worstCaseProfit / price) * 100 : 0;

                // Best Case
                const bestCaseCost = min_sessions * costPerSession;
                const bestCaseProfit = price - bestCaseCost - serverCost;
                const bestCaseMargin = price > 0 ? (bestCaseProfit / price) * 100 : 0;

                // Average Case
                const avgSessions = max_sessions * 0.5;
                const avgCost = avgSessions * costPerSession;
                const avgProfit = price - avgCost - serverCost;
                const avgMargin = price > 0 ? (avgProfit / price) * 100 : 0;
                
                totalAverageMargin += avgMargin;
                tierCount++;

                // --- Display Results in Table ---
                const row = document.createElement('tr');
                
                // Helper to create a cell with formatted profit and margin
                const createProfitMarginCell = (profit, margin) => {
                    const cell = document.createElement('td');
                    cell.className = 'px-6 py-4 whitespace-nowrap';
                    const profitColor = profit >= 0 ? 'positive-margin' : 'negative-margin';
                    cell.innerHTML = `
                        <div class="font-semibold ${profitColor}">$${profit.toFixed(2)}</div>
                        <div class="text-sm text-gray-400">(${margin.toFixed(2)}%)</div>
                    `;
                    return cell;
                };

                row.innerHTML = `<td class="px-6 py-4 whitespace-nowrap text-white font-semibold">${tierName}</td>`;
                row.appendChild(createProfitMarginCell(worstCaseProfit, worstCaseMargin));
                row.appendChild(createProfitMarginCell(bestCaseProfit, bestCaseMargin));
                row.appendChild(createProfitMarginCell(avgProfit, avgMargin));
                
                resultsTable.appendChild(row);
            }

            // --- Calculate and Display Overall Average ---
            const overallAverage = tierCount > 0 ? totalAverageMargin / tierCount : 0;
            overallAverageEl.textContent = `${overallAverage.toFixed(2)}%`;
            overallAverageEl.classList.toggle('positive-margin', overallAverage >= 0);
            overallAverageEl.classList.toggle('negative-margin', overallAverage < 0);
        }

        // --- EVENT LISTENERS ---
        inputs.forEach(input => {
            input.addEventListener('input', calculateMargins);
        });

        // --- INITIAL CALCULATION ON PAGE LOAD ---
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', calculateMargins);
        } else {
            calculateMargins();
        }
    </script>
</body>
</html>
